#!/bin/bash
# REPLbot script to run Cursor Agent CLI in a specified directory.
#
# Scripts are executed as "./script run <id>" to start the REPL,
# and as "./script kill <id>" to stop it.
#
# The <id> parameter is used as the relative directory path under /Users/crossbow/git/
# For example: "cursor-agent replbot" will start Cursor Agent in /Users/crossbow/git/replbot/
#
BASE_DIR="/Users/crossbow/git"

case "$1" in
  run)
    # $2 is the session ID from REPLbot (like replbot_C098UB6JMJP_1754543242_905589)
    
    # Default to the current directory (where replbot is running)
    # In future, could parse directory from initial Slack message
    WORK_DIR="$(pwd)"
    
    echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
    echo "Cursor Agent REPL Session"
    echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
    echo
    echo "Working directory: $WORK_DIR"
    echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
    echo
    
    # Change to the working directory
    cd "$WORK_DIR"
    
    # Start Cursor Agent CLI
    # Don't use exec so the script can handle signals properly
    # Note: cursor-agent may need specific flags for proper REPL integration
    cursor-agent 2>&1
    ;;
    
  kill)
    # No cleanup needed - we're working with existing directories
    # tmux/REPLbot will handle process termination
    ;;
    
  *)
    echo "Syntax: $0 (run|kill) <relative-directory-path>"
    exit 1
    ;;
esac